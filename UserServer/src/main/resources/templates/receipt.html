<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sign In</title>
	<link rel="stylesheet" href="style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
	
	<header>
		<h1>CartCrafters</h1>
	</header>
	
	<header>
		<h2>Your Receipt</h2>
	</header>
	
			<div class="container">
		<table id="userInfo" border="1">
		<tr>
			<th>First Name</th>
			<th>Last Name</th>
			<th>Address</th>
			<th>Postal</th>
			<th>City</th>
			<th>Province</th>
			<th>Country</th>
		</tr>
		</table>
	</div>
	
	<div class="container">
		<table id="itemInfo" border="1">
		<tr>
			<th>Item Name</th>
			<th>Total Price</th>
			<th>Shipping</th>
		</tr>
		</table>
	</div>
	
		<div class="container">
        <table id="shippingInfo" border="1">
            <tr>
                <th>Shipping Price</th>
            </tr>
        </table>
    </div>
    
    <div class="container">
        <table id="totalInfo" border="1">
            <tr>
                <th>Total Price (including tax)</th>
            </tr>
        </table>
    </div>
	
	<p>Your item will ship out within 3 business days.</p>
	
	<div class="container">
		<table id="shippingInfo" border="1">
		<tr>
			<th></th>
		</tr>
		</table>
	</div>
	
	
	
	<button onclick="window.location.href='http:/localhost:8080/landing-user';">Back to Homepage</button>
	
	<button onclick="window.location.href='http://localhost:9090/search-item';">Search for items</button>

	<script>
        $(document).ready(function () {
            // Fetch user information
            $.ajax({
                url: "http://localhost:8080/user/checkout-get-username",
                type: 'GET',
                success: function (result) {
                    var checkout_user = {
                        username: result
                    };
                    $.ajax({
                        url: "http://localhost:8080/user/get-username",
                        type: 'GET',
                        data: checkout_user,
                        success: function (results) {
                            var table = $("#userInfo");
                            results.forEach(function (user) {
                                var row = $("<tr></tr>");
                                row.append($("<td></td>").text(user.fName));
                                row.append($("<td></td>").text(user.lName));
                                row.append($("<td></td>").text(user.address));
                                row.append($("<td></td>").text(user.postal));
                                row.append($("<td></td>").text(user.city));
                                row.append($("<td></td>").text(user.province));
                                row.append($("<td></td>").text(user.country));
                                table.append(row);
                            });
                        },
                        error: function (error) {
                            console.log(error);
                        }
                    })
                },
                error: function (error) {
                    console.log(error);
                }
            });

            // Fetch item information-- Hardcoed!! Needs to be updated.
            var checkout_item = {
                itemID: 13
            };
            $.ajax({
                url: "http://localhost:9090/item/get-id",
                type: 'GET',
                data: checkout_item,
                success: function (results) {
                    var itemTable = $("#itemInfo");
                    var shippingTable = $("#shippingInfo");
                    var totalTable = $("#totalInfo");

                    results.forEach(function (item) {
                        var itemRow = $("<tr></tr>");
                        itemRow.append($("<td></td>").text(item.name));
                        var totalPrice = item.price;

                        // shippingPriceVariable is the placeholder name for the shipping price. Change as needed.
                        var shippingRow = $("<tr></tr>");
                        var shippingPrice = 'shippingPriceVariable';
                        shippingRow.append($("<td></td>").text(shippingPrice));
                        totalPrice += parseFloat(shippingPrice);
                        shippingTable.append(shippingRow);

                        var totalRow = $("<tr></tr>");
                        var taxRate = 0.13;
                        var taxAmount = totalPrice * taxRate;
                        var totalPriceWithTax = totalPrice + taxAmount;

                        totalRow.append($("<td></td>").text(totalPriceWithTax.toFixed(2)));
                        totalTable.append(totalRow);
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            })
        });
    </script>

</body>
</html>
